#!/bin/bash

export PATH=@BIN_DIR@:$PATH
export FAIRMQ_PATH=@FAIRMQ_BIN_DIR@

SYNC="fairmq-ex-n-m-synchronizer"
SYNC+=" --id Sync"
SYNC+=" --severity debug"
SYNC+=" --channel-config name=sync,transport=zeromq,type=pub,method=bind,address=ipc://ex_n_m_sync"
# SYNC+=" --rate 100"
xterm -geometry 80x25+0+350 -hold -e $SYNC &

SENDER0="fairmq-ex-n-m-sender"
SENDER0+=" --id Sender1"
SENDER0+=" --severity debug"
SENDER0+=" --channel-config name=sync,transport=zeromq,type=sub,method=connect,address=ipc://ex_n_m_sync"
SENDER0+="                  name=data,transport=shmem,type=push,method=connect,address=ipc://ex_n_m_data_1,address=ipc://ex_n_m_data_2,address=ipc://ex_n_m_data_3"
# SENDER0+=" --bad-alloc-max-attempts -1"
SENDER0+=" --sender-index 0"
SENDER0+=" --shm-segment-id 0"
SENDER0+=" --buffer-size 1000000"
SENDER0+=" --num-receivers 3"
xterm -geometry 80x25+500+175 -hold -e $SENDER0 &

SENDER1="fairmq-ex-n-m-sender"
SENDER1+=" --id Sender2"
SENDER1+=" --severity debug"
SENDER1+=" --channel-config name=sync,transport=zeromq,type=sub,method=connect,address=ipc://ex_n_m_sync"
SENDER1+="                  name=data,transport=shmem,type=push,method=connect,address=ipc://ex_n_m_data_1,address=ipc://ex_n_m_data_2,address=ipc://ex_n_m_data_3"
# SENDER1+=" --bad-alloc-max-attempts -1"
SENDER1+=" --sender-index 1"
SENDER1+=" --shm-segment-id 1"
SENDER1+=" --buffer-size 1000000"
SENDER1+=" --num-receivers 3"
xterm -geometry 80x25+500+550 -hold -e $SENDER1 &

RECEIVER0="fairmq-ex-n-m-receiver"
RECEIVER0+=" --id Receiver1"
RECEIVER0+=" --severity debug"
RECEIVER0+=" --channel-config name=data,transport=shmem,type=pull,method=bind,address=ipc://ex_n_m_data_1"
RECEIVER0+="                  name=sink,transport=shmem,type=push,method=connect,address=ipc://ex_n_m_sink"
RECEIVER0+=" --num-senders 2"
xterm -geometry 80x25+1000+0 -hold -e $RECEIVER0 &

RECEIVER1="fairmq-ex-n-m-receiver"
RECEIVER1+=" --id Receiver2"
RECEIVER1+=" --severity debug"
RECEIVER1+=" --channel-config name=data,transport=shmem,type=pull,method=bind,address=ipc://ex_n_m_data_2"
RECEIVER1+="                  name=sink,transport=shmem,type=push,method=connect,address=ipc://ex_n_m_sink"
RECEIVER1+=" --num-senders 2"
xterm -geometry 80x25+1000+350 -hold -e $RECEIVER1 &

RECEIVER2="fairmq-ex-n-m-receiver"
RECEIVER2+=" --id Receiver3"
RECEIVER2+=" --severity debug"
RECEIVER2+=" --channel-config name=data,transport=shmem,type=pull,method=bind,address=ipc://ex_n_m_data_3"
RECEIVER2+="                  name=sink,transport=shmem,type=push,method=connect,address=ipc://ex_n_m_sink"
RECEIVER2+=" --num-senders 2"
xterm -geometry 80x25+1000+700 -hold -e $RECEIVER2 &

SINK="fairmq-ex-n-m-sink"
SINK+=" --id Sink3"
SINK+=" --severity debug"
SINK+=" --channel-config name=sink,transport=shmem,type=pull,method=bind,address=ipc://ex_n_m_sink"
xterm -geometry 80x25+1500+350 -hold -e $SINK &
